ARG FROM_TAG
FROM ${FROM_TAG}

WORKDIR /tmp/patch/
COPY patch/* ./

RUN su hinemos -c '/opt/hinemos/postgresql/bin/pg_ctl start -w -t 90 -s -D /opt/hinemos/var/data -l /opt/hinemos/var/log/postgresql.log' \
  && /tmp/apply_patches.sh \
  && /tmp/apply_sql_patches.sh \
  && su hinemos -c '/opt/hinemos/postgresql/bin/pg_ctl stop -w -t 90 -s -D /opt/hinemos/var/data -m fast'

RUN rm -rf /tmp/patch

WORKDIR /root
